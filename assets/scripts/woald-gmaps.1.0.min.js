(function(m){var r=r||{};r.createDelegate=function(g,d){return function(){return d.apply(g,arguments)}};r.createCallback=function(g,d,k){return function(){var s=arguments.length;if(s>0){for(var t=[],a=0;a<s;a++)t[a]=arguments[a];t[s]=k;return g.apply(d||this,t)}return g.call(d||this,k)}};m.Woald||(m.Woald=r)})(window,document);
(function(m,r,g,d,k,s,t){d.gmaps=function(a){this.$window=k(m);this.options=a||{};this.ajaxUrl=t.url;this.nonce=t.nonce;this.infoWindowIndex=this.id=0;this.queryLimitTimeout=typeof a.queryLimitTimeout==="number"?a.queryLimitTimeout:200;this.traffic=typeof a.traffic==="boolean"?a.traffic:false;this.avoidHighways=typeof a.highway==="boolean"?a.highway:false;this.avoidTolls=typeof a.toll==="boolean"?a.toll:false;this.enableDirection=typeof a.enableDirection==="boolean"?a.enableDirection:true;this.enableDirectionButton=
typeof a.enableDirectionButton==="boolean"?a.enableDirectionButton:true;this.showDirectionStepsInline=typeof a.showDirectionStepsInline==="boolean"?a.showDirectionStepsInline:false;this.showInfoWindow=typeof a.showInfoWindow==="boolean"?a.showInfoWindow:false;this.enableDirectionPanel=typeof a.enableDirectionPanel==="boolean"?a.enableDirectionPanel:true;this.enableScrollWheel=typeof a.enableScrollWheel==="boolean"?a.enableScrollWheel:true;this.displayMap=typeof a.displayMap==="boolean"?a.displayMap:
true;if(this.showDirectionStepsInline)this.enableDirectionPanel=false;this.draggableMarker=typeof a.draggableMarker==="boolean"?a.draggableMarker:true;this.selectedTravelMode=a.selectedTravelMode?a.selectedTravelMode:"driving";this.styles=a.styledMaps?a.styledMaps:null;this.backgroundGradient=a.backgroundGradient?a.backgroundGradient:null;this.enableCollapseButton=typeof a.enableCollapseButton==="boolean"?a.enableCollapseButton:true;this.enableWaypointButton=typeof a.enableWaypointButton==="boolean"?
a.enableWaypointButton:true;this.enableDepartureField=typeof a.enableDepartureField==="boolean"?a.enableDepartureField:true;this.enableDestinationField=typeof a.enableDestinationField==="boolean"?a.enableDestinationField:true;this.departurePlaceholder=a.departurePlaceholder?a.departurePlaceholder:"Departure";this.destinationPlaceholder=a.destinationPlaceholder?a.destinationPlaceholder:"Destination";this.fromPlacesPreload=typeof a.fromPlacesPreload==="boolean"?a.fromPlacesPreload:false;this.toPlacesPreload=
typeof a.toPlacesPreload==="boolean"?a.toPlacesPreload:false;this.panToZoom=typeof a.panToZoom==="number"?a.panToZoom:0;this.enableContextMenu=typeof a.enableContextMenu==="boolean"?a.enableContextMenu:true;this.waypointsMax=typeof a.waypointsMax==="number"?a.waypointsMax:8;this.unit=a.unitType||g.maps.UnitSystem.METRIC;this.km=this.unit===g.maps.UnitSystem.METRIC;this.miles=!this.km;this.defer=typeof a.defer==="boolean"?a.defer:false;this.optimizeWaypoints=a.optimizeWaypoints||false;this.mapHeight=
a.mapHeight?a.mapHeight:null;this.stopover=a.stopover?a.stopover:true;this.waypointMax=typeof a.waypointMax==="number"?a.waypointMax:23;this.costUnitType=typeof a.costUnitType==="number"?a.costUnitType:g.maps.UnitSystem.METRIC;this.fromPlaces=a.fromPlaces?a.fromPlaces:[];this.toPlaces=a.toPlaces?a.toPlaces:[];this.waypoints=a.waypoints?a.waypoints:[];this.defaultFromSelectionCaption=a.defaultFromSelectionCaption?a.defaultFromSelectionCaption:"Select a place";this.defaultToSelectionCaption=a.defaultToSelectionCaption?
a.defaultToSelectionCaption:"Select a place";this.departureContextMenuLabel=a.departureContextMenuLabel?a.departureContextMenuLabel:"Departure";this.destinationContextMenuLabel=a.destinationContextMenuLabel?a.destinationContextMenuLabel:"Destination";this.waypointContextMenuLabel=a.waypointContextMenuLabel?a.waypointContextMenuLabel:"Waypoint";this.directionEmptyError=a.directionEmptyError?a.directionEmptyError:"Provide both a departure and arrival address above to view direction data.";this.directionDataUnavailable=
a.directionDataUnavailable?a.directionDataUnavailable:"No routes available from/to the selected location.";this.decimalPoint=a.decimalPoint?a.decimalPoint:".";this.thousandsSep=a.thousandsSep?a.thousandsSep:",";this.decimalPrecision=a.decimalPrecision?a.decimalPrecision:2;this.excludedComboPlaces=a.excludedComboPlaces?a.excludedComboPlaces:[];this.conversion=this.getConversion();this.waypointMarkerIconUrl=a.waypointMarkerIconUrl?a.waypointMarkerIconUrl:null;this.waypointMarkerIconHeight=a.waypointMarkerIconHeight?
a.waypointMarkerIconHeight:null;this.waypointMarkerIconWidth=a.waypointMarkerIconWidth?a.waypointMarkerIconWidth:null;this.distanceLabelText=a.distanceLabelText?a.distanceLabelText:"Distance";this.durationLabelText=a.durationLabelText?a.durationLabelText:"Duration";this.milesLabelText=a.milesLabelText?a.milesLabelText:"miles";this.kmLabelText=a.kmLabelText?a.kmLabelText:"km";this.nearbySearchKeyword=a.nearbySearchKeyword?a.nearbySearchKeyword:null;this.nearbySearchTypes=a.nearbySearchTypes?a.nearbySearchTypes:
"";this.unitLabelText=this.km?this.kmLabelText:this.milesLabelText;this.zoom=typeof a.zoom==="number"?a.zoom:13;this.enableDistance=typeof a.enableDistance==="boolean"?a.enableDistance:true;this.distanceUpdated=a.distanceUpdated?a.distanceUpdated:null;this.directionUpdated=a.directionUpdated?a.directionUpdated:null;this.mapLoaded=a.mapLoaded?a.mapLoaded:null;this.fromDefaultPlace=a.fromDefaultPlace?a.fromDefaultPlace:null;this.toDefaultPlace=a.toDefaultPlace?a.toDefaultPlace:null;this.preloadLocations=
typeof a.preloadLocations==="boolean"?a.preloadLocations:true;this.fromAddress=a.fromAddress;this.fromLat=a.fromLat;this.fromLng=a.fromLng;this.toAddress=a.toAddress;this.toLat=a.toLat;this.toLng=a.toLng;this.restrictLat=a.restrictLat;this.restrictLng=a.restrictLng;this.restrictRadius=a.restrictRadius?parseInt(a.restrictRadius,10):null;this.costSummaryRequest="calendarista_cost_summary_request"+a.projectId;this.resizeDelegate=d.createDelegate(this,this.resize);this.unloadDelegate=d.createDelegate(this,
this.unloadHandler);this.searchFields=[];if(this.defer){this.initDelegate=d.createDelegate(this,this.initialize);this.$window.on("load",this.initDelegate)}else this.initialize();this.$window.on("resize",this.resizeDelegate);this.$window.on("unload",this.unloadDelegate)};d.gmaps.contextMenu={departure:0,destination:1,waypoint:2};d.gmaps.collapseDirection={inside:0,out:1};d.gmaps.action={onPageLoad:0,onPageLoaded:1};d.gmaps.prototype.initialize=function(){var a=this.options,b,c;this.defaultLocation=
{address:a.regionAddress,lat:a.regionLat?a.regionLat:40.7588908,lng:a.regionLng?a.regionLng:-73.98484159999998,infoWindowIcon:a.regionInfoWindowIcon,infoWindowDescription:a.regionInfoWindowDescription,markerIcon:a.regionMarkerIconUrl,markerIconWidth:a.regionMarkerIconWidth,markerIconHeight:a.regionMarkerIconHeight,showMarker:typeof a.showMapMarker==="boolean"?a.showMapMarker:false};if(this.restrictLat&&this.restrictLng){this.defaultLocation.lat=this.restrictLat;this.defaultLocation.lng=this.restrictLng}b=
new g.maps.LatLng(this.defaultLocation.lat?this.defaultLocation.lat:40.7588908,this.defaultLocation.lng?this.defaultLocation.lng:-73.98484159999998);this.rootId=a.id;this.$root=k("#"+this.rootId);this.$spinner=k("#spinner_map_"+this.rootId);this.$mapElement=this.$root.find(".woald-map-canvas");this.$controls=this.$root.find(".woald-knobs");this.$gallery=this.$root.find(".woald-gallery");this.$travelModeList=this.$root.find(".woald-travelmode-list a");this.$travelModeHeading=this.$root.find(".woald-travelmode-heading");
for(c=0;c<this.$travelModeList.length;c++){this.travelModeItemClickDelegate=d.createDelegate(this,this.travelModeItemClick);k(this.$travelModeList[c]).on("click",this.travelModeItemClickDelegate)}if(this.enableDirection){this.directionsService=new g.maps.DirectionsService;this.directionsDisplay=new g.maps.DirectionsRenderer({draggable:this.draggableMarker,suppressMarkers:this.showDirectionStepsInline})}this.displayMap||this.$root.find(".woald-map-placeholder").hide();if(this.restrictLat&&this.restrictLng){c=
new g.maps.Circle({radius:this.restrictRadius,center:new g.maps.LatLng(this.restrictLat,this.restrictLng)});this.bounds=c.getBounds()}b={center:b,zoom:this.zoom,styles:this.styles,mapTypeId:g.maps.MapTypeId.ROADMAP,panControl:false,zoomControl:false,mapTypeControl:false,scaleControl:false,streetViewControl:false,overviewMapControl:false,scrollwheel:this.enableScrollWheel,clickableIcons:false};if(this.bounds)b.restriction={latLngBounds:this.bounds,strictBounds:true};this.map=new g.maps.Map(this.$mapElement[0],
b);if(this.enableContextMenu){this.mapContextMenuDelegate=d.createDelegate(this,this.mapContextMenuHandler);g.maps.event.addListener(this.map,"rightclick",this.mapContextMenuDelegate);this.contextMenuExitDelegate=d.createDelegate(this,this.contextMenuExitHandler);g.maps.event.addListener(this.map,"click",this.contextMenuExitDelegate);k(m.document).on("click",this.contextMenuExitDelegate)}this.tilesLoadedDelegate=d.createDelegate(this,this.tilesLoadedHandler);g.maps.event.addListener(this.map,"tilesloaded",
this.tilesLoadedDelegate);this.initControls(a);a=this.$controls.detach();this.map.controls[g.maps.ControlPosition.TOP_LEFT].push(a[0]);a.removeClass("hide");this.progressIndicator("show");this.browserSupportFlag=new Boolean(false);this.enableDistance&&this.$distanceContainer.removeClass("hide");this.setBackgroundGradient();this.mapHeight&&this.$mapElement.css("height",this.mapHeight+"px");a=this.genDropdownLists();this.$fromLatLng.attr("type")==="text"&&!a.from&&this.preloadPlaces(this.$fromLatLng,
this.$departureField);this.$toLatLng.attr("type")==="text"&&!a.to&&this.preloadPlaces(this.$toLatLng,this.$destinationField);this.autocompleteInit();this.$mapDiv=k(this.map.getDiv());if(this.enableContextMenu){this.$mapDiv.append(this.getContextMenu());this.$contextMenu=this.$root.find(".woald-gmaps-contextmenu");this.contextMenuItemClickDelegate=d.createDelegate(this,this.contextMenuItemClickHandler);this.$contextMenu.find("a").on("click",this.contextMenuItemClickDelegate)}this.$fromLatLng.attr("placeholder",
this.departurePlaceholder);this.$toLatLng.attr("placeholder",this.destinationPlaceholder);this.maintainDepartureState();this.maintainDestinationState();this.initializeWaypoints();this.defaultLocationInit()};d.gmaps.prototype.setBackgroundGradient=function(){this.$photoBackground.addClass(this.backgroundGradient)};d.gmaps.prototype.travelModeItemClick=function(a){var b=k(a.currentTarget),c=b.data("woaldDrivingmode");a.preventDefault();this.selectedTravelMode=c;this.$travelModeList.find("i").remove();
this.$travelModeHeading.html(k.trim(b.text()));b.append('<i class="fa fa-ok-sign pull-right"></i>');this.showDirection()};d.gmaps.prototype.initControls=function(a){this.$fromLatLng=this.$root.find('input[name="fromLatLng"]');this.$toLatLng=this.$root.find('input[name="toLatLng"]');this.$options1Container=this.$root.find(".woald-options1-container");this.$options2Container=this.$root.find(".woald-options2-container");this.$highway=this.$root.find('input[name="highway"]');this.$toll=this.$root.find('input[name="toll"]');
this.$traffic=this.$root.find('input[name="traffic"]');this.$reverse=this.$root.find(".woald-reverse");this.$direction=this.$root.find(".woald-direction");this.$measurementContainer=this.$root.find(".woald-measurement-container");this.$miles=this.$root.find(".woald-miles");this.$km=this.$root.find(".woald-km");this.$directionPanelContainer=this.$root.find(".woald-direction-panel-container");this.$directionPanel=this.$root.find(".woald-direction-panel");this.$directionPanelCloseButton=this.$directionPanel.find("button");
this.$directionDataEmpty=this.$root.find(".woald-direction-empty");this.$myPosButton=this.$root.find('button[name="mypos"]');this.$departureGroup=this.$root.find(".woald-departure-group");this.$destinationGroup=this.$root.find(".woald-destination-group");this.$errorPanelContainer=this.$root.find(".woald-error-panel-container");this.$errorPanel=this.$root.find(".woald-error-panel");this.$errorPanelCloseButton=this.$errorPanel.find("button");this.$errorContainer=this.$root.find(".woald-error-container");
this.posErrorMsg=a.posErrorMsg||"An error occurred while trying to determine your position.";this.geolocationErrorMsg=a.geolocationErrorMsg||"Your browser does not support geolocation. We have placed you somewhere.";this.$photoBackground=this.$root.find(".woald-photo-background");this.$zoomInButton=this.$root.find(".woald-zoom-in-button");this.$zoomOutButton=this.$root.find(".woald-zoom-out-button");this.$distancePlaceHolder=this.$root.find(".woald-distance-placeholder");this.$distanceContainer=this.$root.find(".woald-total-distance-container");
this.$totalCost=this.$root.find(".woald-total-cost");this.$waypoints=this.$root.find(".woald-waypoints-placeholder");this.$waypointsAddButton=this.$root.find('button[name="add"]');this.$waypointsAddButtonContainer=this.$root.find(".woald-waypoint-add-button-container");this.$departureFieldContainer=this.$root.find(".woald-departure-field-container");this.$destinationFieldContainer=this.$root.find(".woald-destination-field-container");this.$validators=this.$root.find(".woald_parsley_validated");this.$departureField=
this.$root.find('input[name="departure"]');this.$destinationField=this.$root.find('input[name="destination"]');this.$distanceField=this.$root.find('input[name="distance"]');this.$durationField=this.$root.find('input[name="duration"]');this.$unitField=this.$root.find('input[name="unit"]');this.$waypointsField=this.$root.find('input[name="waypoints"]');this.$contextMenuHint=this.$root.find(".woald-map-hint");this.$fromPlaceId=this.$root.find('input[name="fromPlaceId"]');this.$toPlaceId=this.$root.find('input[name="toPlaceId"]');
if(this.$highway.length>0){this.highwayClickDelegate=d.createDelegate(this,this.highwayClickHandler);this.$highway.on("change",this.highwayClickDelegate);this.avoidHighways&&this.$highway.prop("checked",true)}if(this.$toll.length>0){this.tollClickDelegate=d.createDelegate(this,this.tollClickHandler);this.$toll.on("change",this.tollClickDelegate);this.avoidTolls&&this.$toll.prop("checked",true)}if(this.$traffic.length>0){this.trafficClickDelegate=d.createDelegate(this,this.trafficClickHandler);this.$traffic.on("change",
this.trafficClickDelegate);this.traffic&&this.$traffic.prop("checked",true)}if(this.enableDirection){if(this.$reverse.length>0){this.reverseClickDelegate=d.createDelegate(this,this.reverseClickHandler);this.$reverse.on("click",this.reverseClickDelegate)}if(this.enableDirectionPanel&&!this.showDirectionStepsInline)if(this.$direction.length>0){this.directionClickDelegate=d.createDelegate(this,this.directionClickHandler);this.$direction.on("click",this.directionClickDelegate)}}if(this.$miles.length>
0){this.milesClickDelegate=d.createDelegate(this,this.milesClickHandler);this.$miles.on("click",this.milesClickDelegate);this.miles&&this.$miles.addClass("active")}if(this.$km.length>0){this.kmClickDelegate=d.createDelegate(this,this.kmClickHandler);this.$km.on("click",this.kmClickDelegate);this.km&&this.$km.addClass("active")}if(this.$myPosButton.length>0){this.myPosClickDelegate=d.createDelegate(this,this.myPosClickHandler);this.$myPosButton.on("click",this.myPosClickDelegate)}if(this.$directionPanelCloseButton.length>
0){this.directionPanelCloseDelegate=d.createDelegate(this,this.directionPanelCloseHandler);this.$directionPanelCloseButton.on("click",this.directionPanelCloseDelegate)}if(this.$errorPanelCloseButton.length>0){this.errorPanelCloseDelegate=d.createDelegate(this,this.errorPanelCloseHandler);this.$errorPanelCloseButton.on("click",this.errorPanelCloseDelegate)}if(this.$zoomInButton.length>0){this.zoomInDelegate=d.createDelegate(this,this.zoomInHandler);this.$zoomInButton.on("click",this.zoomInDelegate)}if(this.$zoomOutButton.length>
0){this.zoomOutDelegate=d.createDelegate(this,this.zoomOutHandler);this.$zoomOutButton.on("click",this.zoomOutDelegate)}if(this.enableDirection&&this.$directionPanel.length>0){this.$directionPanelContainer.removeClass("hide");this.directionsDisplay.setMap(this.map);this.enableDirectionPanel&&this.directionsDisplay.setPanel(this.$directionPanel[0]);this.directionsChangedDelegate=d.createDelegate(this,this.directionsChangedHandler);g.maps.event.addListener(this.directionsDisplay,"directions_changed",
this.directionsChangedDelegate)}if(this.enableWaypointButton&&this.$waypointsAddButton.length>0){this.waypointsAddDelegate=d.createDelegate(this,this.waypointsAddHandler);this.$waypointsAddButton.on("click",this.waypointsAddDelegate)}this.autocompleteOnPasteDelegate=d.createDelegate(this,this.autocompleteOnPasteHandler);this.$fromLatLng.on("paste",this.autocompleteOnPasteDelegate);this.$toLatLng.on("paste",this.autocompleteOnPasteDelegate);if(this.enableDirectionPanel){this.directionPanelToggleDelegate=
d.createDelegate(this,this.directionPanelToggleHandler);this.$directionPanel.on("shown.bs.collapse",this.directionPanelToggleDelegate);this.$directionPanel.on("hidden.bs.collapse",this.directionPanelToggleDelegate)}};d.gmaps.prototype.contextMenuItemClickHandler=function(a,b){var c=k(a.currentTarget),e=c.parent(),f=parseInt(c.attr("data-woald-menu"),10);c=this.$root.find('input[data-woald-waypoint-id="'+parseInt(c.attr("data-woald-waypoint-id"),10)+'"]');var h=parseFloat(e.attr("data-woald-lat"));
e=parseFloat(e.attr("data-woald-lng"));e=[h,e].join(",");c.length>0&&c.attr("data-woald-desc");switch(f){case 0:this.$fromLatLng.val("");this.geocodeRequest(e,{infoWindow:this.infoWindowFrom,marker:this.fromMarker,elem:this.$fromLatLng,hiddenField:this.$departureField});break;case 1:this.$toLatLng.val("");this.geocodeRequest(e,{infoWindow:this.infoWindowTo,marker:this.toMarker,elem:this.$toLatLng,hiddenField:this.$destinationField});break;case 2:c.val("");this.geocodeRequest(e,b)}this.contextMenuExitHandler();
return false};d.gmaps.prototype.contextMenuExitHandler=function(){this.$contextMenu.hasClass("hide")||this.$contextMenu.addClass("hide")};d.gmaps.prototype.mapContextMenuHandler=function(a){a.stop();a.latLng.lat();a.latLng.lng();var b=this.fromLatLngToPoint(a.latLng),c=b.x,e=b.y,f=this.$mapDiv.width(),h=this.$mapDiv.height(),i,j,l=this;m.setTimeout(function(){l.$contextMenu.removeClass("hide");i=l.$contextMenu.width();j=l.$contextMenu.height();if(f-c<i)c=Math.abs(c-i);if(h-e<j)e=Math.abs(e-j);l.$contextMenu.attr("data-woald-lat",
a.latLng.lat()).attr("data-woald-lng",a.latLng.lng());l.$contextMenu.css({left:c+"px",top:e+"px"})},10);return false};d.gmaps.prototype.fromLatLngToPoint=function(a){var b=Math.pow(2,this.map.getZoom()),c=new g.maps.LatLng(this.map.getBounds().getNorthEast().lat(),this.map.getBounds().getSouthWest().lng());c=this.map.getProjection().fromLatLngToPoint(c);a=this.map.getProjection().fromLatLngToPoint(a);return new g.maps.Point(Math.floor((a.x-c.x)*b),Math.floor((a.y-c.y)*b))};d.gmaps.prototype.autocompleteOnPasteHandler=
function(a){(function(b){return setTimeout(function(){var c=b.val();b.blur();b.val(c);return b.focus()},1)})(k(a.currentTarget),this)};d.gmaps.prototype.genDropdownLists=function(){var a,b={from:false,to:false};if(this.fromPlaces.length>1){this.$departureGroup.parent().removeClass("input-group");this.$departureGroup.addClass("hide");a=this.getDropdownList(this.fromPlaces,"fromLatLng",this.defaultFromSelectionCaption,this.fromPlacesPreload,this.$departureField);this.fromLatLngChangeDelegate=d.createDelegate(this,
this.fromLatLngChangedHandler);a.on("change",this.fromLatLngChangeDelegate);this.$fromLatLng.replaceWith(a);this.$fromLatLng=this.$root.find('select[name="fromLatLng"]')}else if(this.fromPlaces.length===1){a=this.fromPlaces[0];b.from=true;this.preloadPlaces(this.$fromLatLng,this.$departureField,a,true);this.$fromLatLng.prop("readonly",true);this.fromPlacesPreload=true}if(this.toPlaces.length>1){this.$destinationGroup.parent().removeClass("input-group");this.$destinationGroup.addClass("hide");a=this.getDropdownList(this.toPlaces,
"toLatLng",this.defaultToSelectionCaption,this.toPlacesPreload,this.$destinationField);this.toLatLngChangeDelegate=d.createDelegate(this,this.toLatLngChangedHandler);a.on("change",this.toLatLngChangeDelegate);this.$toLatLng.replaceWith(a);this.$toLatLng=this.$root.find('select[name="toLatLng"]')}else if(this.toPlaces.length===1){a=this.toPlaces[0];b.to=true;this.preloadPlaces(this.$toLatLng,this.$destinationField,a,true);this.$toLatLng.prop("readonly",true);this.toPlacesPreload=true}if((this.fromPlacesPreload||
this.toPlacesPreload)&&this.searchFields.length>0){a=this.searchFields.splice(this.searchFields.length-1,1)[0];this.geocodeRequest(a[0],a[1])}return b};d.gmaps.prototype.preloadPlaces=function(a,b,c,e){var f,h;h={};var i=c?c.markerIcon:null,j=c?c.markerIconWidth:null,l=c?c.markerIconHeight:null,o=c?c.lat:null,n=c?c.lng:null;f=new g.maps.InfoWindow;if(!this.infoWindows)this.infoWindows=[];this.infoWindows.push(f);c=new g.maps.Marker({map:this.map,anchorPoint:new g.maps.Point(0,-29),draggable:this.draggableMarker,
animation:g.maps.Animation.DROP});if(j&&l)h.scaledSize=new g.maps.Size(j,l);if(i)h.url=i;k.isEmptyObject(h)||c.setIcon(h);if(!this.markers)this.markers=[];this.markers.push(c);h=d.createCallback(this.toggleInfoWindowHandler,this,{infoWindow:f,marker:c});g.maps.event.addListener(c,"click",h);a={infoWindow:f,marker:c,elem:a,hiddenField:b,preloading:true};b=d.createCallback(this.dragEnd,this,a);g.maps.event.addListener(c,"dragend",b);if(e&&o&&n){e=[o,n].join(",");this.searchFields.push([e,a])}};d.gmaps.prototype.fromLatLngChangedHandler=
function(){var a=this.$fromLatLng.find("option:selected"),b=parseInt(a.attr("data-woald-place-id"),10);this.filterLatLngList(b);this.resetMarkersByOptions(this.$fromLatLng.find("option"));this.requestByLatLng({elem:a,hiddenField:this.$departureField,latLng:this.$fromLatLng.val(),preload:this.fromPlacesPreload,index:parseInt(a.attr("data-woald-index"),10),showInfoWindow:true});this.$fromPlaceId.val(b)};d.gmaps.prototype.toLatLngChangedHandler=function(){var a=this.$toLatLng.find("option:selected"),
b=parseInt(a.attr("data-woald-place-id"),10);this.resetMarkersByOptions(this.$toLatLng.find("option"));this.requestByLatLng({elem:a,hiddenField:this.$destinationField,latLng:this.$toLatLng.val(),preload:this.toPlacesPreload,index:parseInt(a.attr("data-woald-index"),10),showInfoWindow:true});this.$toPlaceId.val(b)};d.gmaps.prototype.filterLatLngList=function(a){var b,c,e=this.$toLatLng.find("option"),f,h=this.$toLatLng.val(),i=[];if(!(this.excludedComboPlaces.length===0||e.length<=1)){for(b=0;b<this.excludedComboPlaces.length;b++){c=
this.excludedComboPlaces[b].split(",");f=parseInt(c[0],10);c=parseInt(c[1],10);f===a&&i.push(c)}if(i.length!==0){e.removeAttr("disabled");e.removeAttr("selected");e.removeAttr("hidden");for(a=0;a<e.length;a++){f=k(e[a]);b=parseInt(f.attr("data-woald-place-id"),10);if(i.indexOf(b)!==-1){f.prop("disabled",true);f.prop("hidden",true)}}h&&this.resetDirection()}}};d.gmaps.prototype.requestByLatLng=function(a){var b=a.elem,c=a.hiddenField,e=a.latLng,f=a.preload,h=a.index,i=a.showInfoWindow;a=this.infoWindows[h];
h=this.markers[h];e||(e=b.val());if(e)if(f){if(b=h.getPosition()){this.map.panTo(b);this.closeAllInfoWindows();a.open(this.map,h);this.panToZoom&&this.map.setZoom(this.panToZoom);this.showDirection({showError:false})}}else this.geocodeRequest(e,{infoWindow:a,marker:h,elem:b,hiddenField:c,showInfoWindow:i});else this.fitMarkers()};d.gmaps.prototype.maintainDepartureState=function(){var a,b,c;if(this.fromAddress||this.toAddress)if(this.fromAddress&&this.$fromLatLng.length>0){a=[this.fromLat,this.fromLng].join(",");
if(this.$fromLatLng[0].type!=="text"){this.$fromLatLng.find('option[value="'+a+'"]').prop("selected",true);b=parseInt(this.$fromLatLng.find("option:selected").attr("data-woald-index"),10);c=parseInt(this.$fromLatLng.find("option:selected").attr("data-woald-place-id"),10);this.filterLatLngList(c)}else{this.$fromLatLng.val(this.decodeSpecialCharacters(this.fromAddress));b=0}this.searchFields.push([a,{infoWindow:this.infoWindows[b],marker:this.markers[b],elem:this.$fromLatLng,hiddenField:this.$departureField,
latLng:a,preload:this.fromPlacesPreload,index:b}])}};d.gmaps.prototype.maintainDestinationState=function(){var a,b;if(this.fromAddress||this.toAddress)if(this.toAddress&&this.$toLatLng.length>0){a=[this.toLat,this.toLng].join(",");if(this.$toLatLng[0].type!=="text"){this.$toLatLng.find('option[value="'+a+'"]').prop("selected",true);b=parseInt(this.$toLatLng.find("option:selected").attr("data-woald-index"),10)}else{this.$toLatLng.val(this.decodeSpecialCharacters(this.toAddress));b=this.$fromLatLng.length>
0?1:0}this.searchFields.push([a,{infoWindow:this.infoWindows[b],marker:this.markers[b],elem:this.$toLatLng,hiddenField:this.$destinationField,latLng:a,preload:this.toPlacesPreload,index:b}])}};d.gmaps.prototype.getDropdownList=function(a,b,c,e,f){c=k('<select name="'+b+'" class="form-select calendarista-typography--caption1 woald_parsley_validated" data-parsley-required="true"><option value="">'+c+"</option></select>");var h,i,j,l;for(l=0;l<a.length;l++){i=a[l];j=[i.lat,i.lng].join(",");h=i.name;
h=k('<option value="'+j+'" data-woald-place="'+this.encodedStringify(i)+'"data-woald-place-id="'+i.id+'"data-woald-index="'+this.infoWindowIndex+'">'+h+"</option>");if(b==="fromLatLng"&&j==this.selectedFromPlaceValue||b==="toLatLng"&&j==this.selectedToPlaceValue)h.prop("selected",true);c.append(h);this.preloadPlaces(h,f,i,e);this.infoWindowIndex++}return c};d.gmaps.prototype.getConversion=function(){return this.km?1E3:1609.344};d.gmaps.prototype.setConversion=function(){this.conversion=this.getConversion();
this.unitLabelText=this.km?this.kmLabelText:this.milesLabelText;this.unit=this.km?g.maps.UnitSystem.METRIC:g.maps.UnitSystem.IMPERIAL};d.gmaps.prototype.isValid=function(){var a=true;this.$validators.each(function(){var b=k(this);if(!b.is(":visible")||b.is(":disabled")||b.attr("data-parsley-excluded"))return true;b=b.parsley?b.parsley().validate(true):true;if(b!==null&&typeof b==="object"&&b.length>0)a=false});return a};d.gmaps.prototype.highwayClickHandler=function(){this.avoidHighways=this.$highway.is(":checked");
this.showDirection()};d.gmaps.prototype.tollClickHandler=function(){this.avoidTolls=this.$toll.is(":checked");this.showDirection()};d.gmaps.prototype.trafficClickHandler=function(){this.traffic=this.$traffic.is(":checked");if(!this.trafficLayer){this.trafficLayer=new g.maps.TrafficLayer;this.trafficLayerMapChangedDelegate=d.createDelegate(this,this.trafficLayerMapChangedHandler);g.maps.event.addListener(this.trafficLayer,"map_changed",this.trafficLayerMapChangedDelegate)}this.progressIndicator("show");
this.traffic?this.trafficLayer.setMap(this.map):this.trafficLayer.setMap(null)};d.gmaps.prototype.trafficLayerMapChangedHandler=function(){this.progressIndicator("hide")};d.gmaps.prototype.reverseClickHandler=function(){var a=this.$fromLatLng.val(),b=this.$toLatLng.val(),c=this.$fromLatLng.attr("data-woald-postdata"),e=this.$toLatLng.attr("data-woald-postdata");this.$fromLatLng.val(b);this.$fromLatLng.attr("data-woald-postdata",e);this.$toLatLng.val(a);this.$toLatLng.attr("data-woald-postdata",c);
this.showDirection()};d.gmaps.prototype.directionClickHandler=function(){var a="show",b=this.$fromLatLng.val(),c=this.$toLatLng.val();if(this.enableDirectionPanel){if(this.$direction.hasClass("active")){a="hide";this.closeError()}else if(!b||!c){this.showError(this.directionEmptyError);return}this.$directionPanel.calendaristaCollapse(a)}};d.gmaps.prototype.milesClickHandler=function(){this.miles=!this.$miles.hasClass("active");this.km=!this.miles;this.setConversion();this.showDirection()};d.gmaps.prototype.kmClickHandler=
function(){this.km=!this.$km.hasClass("active");this.miles=!this.km;this.setConversion();this.showDirection()};d.gmaps.prototype.initSearch=function(){var a=this.searchFields.length>0,b;if(a){b=this.searchFields.splice(this.searchFields.length-1,1)[0];this.geocodeRequest(b[0],b[1])}return a};d.gmaps.prototype.myPosClickHandler=function(){this.$fromLatLng.val("");this.geoLocate({infoWindow:this.infoWindowFrom,marker:this.fromMarker,elem:this.$fromLatLng,hiddenField:this.$departureField})};d.gmaps.prototype.directionPanelToggleHandler=
function(a){a.stopPropagation()};d.gmaps.prototype.initializeWaypoints=function(){var a,b,c;for(a=0;a<this.waypoints.length;a++){b=this.waypoints[a];c=this.waypointsAdd(d.gmaps.collapseDirection.inside,d.gmaps.action.onPageLoad,b);c.val(b.address)}this.updateWaypointsField();if(this.enableDirection)this.searchFields.length>0&&this.showDirection({showError:false});else this.initSearch()};d.gmaps.prototype.waypointsAdd=function(a,b,c){var e=++this.id,f=this.$root.find(".woald-waypoint-group");this.$waypoints.append(this.getWaypointsHtml(e,
a));this.enableContextMenu&&this.$contextMenu.append(this.getWaypointContextMenu(e));a=this.$waypoints.find('input[data-woald-waypoint-id="'+e+'"]');a.on("paste",this.autocompleteOnPasteDelegate);this.autocompleteWaypoint(a,e,b,c);b=this.$waypoints.find('button[name="waypointremove"]');c=this.$waypoints.find(".form-group");b.off();c.off();if(!this.waypointsRemoveDelegate)this.waypointsRemoveDelegate=d.createDelegate(this,this.waypointsRemoveHandler);if(!this.collapseWaypointDelegate)this.collapseWaypointDelegate=
d.createDelegate(this,this.collapseWaypointHandler);c.on("hidden.bs.collapse",this.collapseWaypointDelegate);b.on("click",this.waypointsRemoveDelegate);this.$waypoints.find(".collapse.out").calendaristaCollapse("show");if(c.length>=this.waypointMax)this.$waypointsAddButton.prop("disabled",true);else c.length<this.waypointMax&&this.$waypointsAddButton.removeAttr("disabled");f.length>=this.waypointsMax&&this.$waypointsAddButton.prop("disabled",true);return a};d.gmaps.prototype.waypointsAddHandler=function(){this.waypointsAdd(d.gmaps.collapseDirection.out,
d.gmaps.action.onPageLoaded)};d.gmaps.prototype.collapseWaypointHandler=function(a){a.stopPropagation();var b=k(a.currentTarget);a=b.closest(".form-group");var c=a.find('input[name="waypoint[]"]');b=b.find('button[name="waypointremove"]');var e=parseInt(b.data("woaldId"),10),f=this.findObject(this.autocompletesWaypoint,e),h=this.findObject(this.markersWaypoint,e),i=this.findObject(this.infoWindowsWaypoint,e);e=this.$contextMenu?this.$contextMenu.find('a[data-woald-waypoint-id="'+e+'"]'):null;--this.id;
this.isOpen(i.result)&&i.result.close(this.map,h.result);h.result.setMap(null);g.maps.event.clearListeners(f.result,"place_changed");g.maps.event.clearListeners(h.result,"click");c.off();this.autocompletesWaypoint.splice(f.i,1);this.markersWaypoint.splice(h.i,1);this.infoWindowsWaypoint.splice(i.i,1);a.off();b.off();a.remove();e&&e.remove();this.$waypoints.find(".form-group").length<this.waypointMax&&this.$waypointsAddButton.removeAttr("disabled");a=this.$root.find(".woald-waypoint-group");for(c=
0;c<a.length;c++){b=k(a[c]);f=b.find(".woald-waypoint-badge");f.html(c+1)}if(this.enableContextMenu){b=this.$root.find(".woald-gmaps-contextmenu a[data-woald-waypoint-id]");for(c=0;c<b.length;c++){f=k(b[c]);f=f.find(".woald-waypoint-badge");f.html(c+1)}}a.length<this.waypointsMax&&this.$waypointsAddButton.removeAttr("disabled");this.updateWaypointsField();this.showDirection({showError:false})};d.gmaps.prototype.findObject=function(a,b){var c=null,e,f;for(e=0;e<a.length;e++){f=a[e];if(f.id===b){c=
f.obj;break}}return{result:c,i:e}};d.gmaps.prototype.waypointsRemoveHandler=function(a){k(a.currentTarget).closest(".form-group").calendaristaCollapse("hide")};d.gmaps.prototype.zoomOutHandler=function(){var a=this.map.getZoom();a!==0&&this.map.setZoom(a-1)};d.gmaps.prototype.zoomInHandler=function(){var a=this.map.getZoom();a!==21&&this.map.setZoom(a+1)};d.gmaps.prototype.tilesLoadedHandler=function(){this.progressIndicator("hide");this.mapLoaded&&this.mapLoaded(this.map)};d.gmaps.prototype.progressIndicator=
function(a){a==="show"?this.$spinner.removeClass("calendarista-invisible"):this.$spinner.addClass("calendarista-invisible")};d.gmaps.prototype.getLocality=function(a){var b,c;for(b=0;b<a.address_components.length;b++){c=a.address_components[b];if(c.types&&c.types[0]==="locality")return c.long_name}return""};d.gmaps.prototype.defaultLocationInit=function(){var a={};if(!(!this.defaultLocation.lat||!this.defaultLocation.lng||this.searchFields.length>0))if(!(this.fromAddress&&this.toAddress)){this.defaultLocationInfoWindow=
new g.maps.InfoWindow;this.defaultLocationMarker=new g.maps.Marker({map:this.map,anchorPoint:new g.maps.Point(0,-29),draggable:this.draggableMarker,animation:g.maps.Animation.DROP});if(this.defaultLocation.markerIconWidth&&this.defaultLocation.markerIconHeight)a.scaledSize=new g.maps.Size(this.defaultLocation.markerIconWidth,this.defaultLocation.markerIconHeight);if(this.defaultLocation.markerIcon)a.url=this.defaultLocation.markerIcon;k.isEmptyObject(a)||this.defaultLocationMarker.setIcon(a);a=d.createCallback(this.toggleInfoWindowHandler,
this,{infoWindow:this.defaultLocationInfoWindow,marker:this.defaultLocationMarker});g.maps.event.addListener(this.defaultLocationMarker,"click",a);a=d.createCallback(this.dragEnd,this,{infoWindow:this.defaultLocationInfoWindow,marker:this.defaultLocationMarker,hiddenField:null,elem:null});g.maps.event.addListener(this.defaultLocationMarker,"dragend",a);a=k("<input>").attr({type:"hidden",id:"woald_default_location",name:"woald_default_location"});a.appendTo(this.$root).attr("data-woald-place",this.encodedStringify(this.defaultLocation));
this.geocodeRequest([this.defaultLocation.lat,this.defaultLocation.lng].join(","),{infoWindow:this.defaultLocationInfoWindow,marker:this.defaultLocationMarker,elem:a,hiddenField:a})}};d.gmaps.prototype.autocompleteInit=function(){var a,b,c;c={};if(this.bounds){c.strictBounds=true;c.bounds=this.bounds}if(!this.autocompletes)this.autocompletes=[];if(this.$fromLatLng.attr("type")==="text"){this.infoWindowFrom=this.infoWindows[0];this.fromMarker=this.markers[0];a={infoWindow:this.infoWindowFrom,marker:this.fromMarker,
hiddenField:this.$departureField,elem:this.$fromLatLng};b=new g.maps.places.Autocomplete(this.$fromLatLng[0],c);b.bindTo("bounds",this.map);this.autocompletes.push(b);a=d.createCallback(this.autocomplete,this,[b,a]);g.maps.event.addListener(b,"place_changed",a)}if(this.$toLatLng.attr("type")==="text"){this.infoWindowTo=this.infoWindows[this.infoWindows.length===1?0:1];this.toMarker=this.markers[this.markers.length===1?0:1];b={infoWindow:this.infoWindowTo,marker:this.toMarker,hiddenField:this.$destinationField,
elem:this.$toLatLng};c=new g.maps.places.Autocomplete(this.$toLatLng[0],c);c.bindTo("bounds",this.map);this.autocompletes.push(c);b=d.createCallback(this.autocomplete,this,[c,b]);g.maps.event.addListener(c,"place_changed",b)}};d.gmaps.prototype.autocompleteWaypoint=function(a,b,c,e){var f,h,i,j,l=this.$contextMenu?this.$contextMenu.find('a[data-woald-waypoint-id="'+b+'"]'):null;e=e;j={};f={};if(this.bounds){f.strictBounds=true;f.bounds=this.bounds}f=new g.maps.places.Autocomplete(a[0],f);f.bindTo("bounds",
this.map);if(!this.autocompletesWaypoint)this.autocompletesWaypoint=[];this.autocompletesWaypoint.push({id:b,obj:f});h=new g.maps.InfoWindow;if(!this.infoWindowsWaypoint)this.infoWindowsWaypoint=[];this.infoWindowsWaypoint.push({id:b,obj:h});i=new g.maps.Marker({map:this.map,anchorPoint:new g.maps.Point(0,-29),draggable:this.draggableMarker,animation:g.maps.Animation.DROP});if(this.waypointMarkerIconWidth&&this.waypointMarkerIconHeight)j.scaledSize=new g.maps.Size(this.waypointMarkerIconWidth,this.waypointMarkerIconHeight);
if(this.waypointMarkerIconUrl)j.url=this.waypointMarkerIconUrl;k.isEmptyObject(j)||i.setIcon(j);if(!this.markersWaypoint)this.markersWaypoint=[];this.markersWaypoint.push({id:b,obj:i});b=d.createCallback(this.toggleInfoWindowHandler,this,{infoWindow:h,marker:i});g.maps.event.addListener(i,"click",b);b={infoWindow:h,marker:i,hiddenField:this.$waypointsField,elem:a};j=d.createCallback(this.dragEnd,this,b);h=d.createCallback(this.autocomplete,this,[f,b]);g.maps.event.addListener(i,"dragend",j);g.maps.event.addListener(f,
"place_changed",h);if(this.enableContextMenu&&l){f=d.createCallback(this.contextMenuItemClickHandler,this,b);l.on("click",f)}if(this.preloadLocations&&c===d.gmaps.action.onPageLoad){if(!e)if(e=a.attr("data-woald-postdata"))e=this.JSONParse(e);if(e){a=[e.lat,e.lng].join(",");this.searchFields.push([a,b])}}};d.gmaps.prototype.autocomplete=function(a){var b=a[0].getPlace();a=a[1];a.pos=[b.geometry.location.lat(),b.geometry.location.lng()].join(",");this.clearDefaultLocation();this.locate(b,a);this.showDirection({showError:false})};
d.gmaps.prototype.resetMarkers=function(){var a,b;for(a in this.markers)this.markers[a].setVisible(false);for(a in this.infoWindows)this.infoWindows[a].close();for(a in this.infoWindowsWaypoint)this.infoWindowsWaypoint[a].obj.close();for(a in this.markersWaypoint)this.markersWaypoint[a].obj.setVisible(false);if(this.directionsInfoWindows){b=this.directionsInfoWindows.length;for(a=0;a<b;a++){this.directionsInfoWindows[a].close();delete this.directionsInfoWindows[a]}this.directionsInfoWindows.length=
0}this.clearDefaultLocation()};d.gmaps.prototype.resetMarkersByOptions=function(a){var b,c;for(b=0;b<a.length;b++){c=parseInt(k(a[b]).attr("data-woald-index"),10);if(!isNaN(c)){this.markers[c].setVisible(false);this.infoWindows[c].close()}}if(this.directionsInfoWindows){for(b=0;b<this.directionsInfoWindows.length;b++){this.directionsInfoWindows[b].close();delete this.directionsInfoWindows[b]}this.directionsInfoWindows.length=0}};d.gmaps.prototype.clearDefaultLocation=function(){var a,b;if(this.directionsMarkers){a=
this.directionsMarkers.length;for(b=0;b<a;b++){this.directionsMarkers[b].setVisible(false);g.maps.event.clearListeners(this.directionsMarkers[b],"click");delete this.directionsMarkers[b]}this.directionsMarkers.length=0}if(this.defaultLocationInfoWindow){this.defaultLocationInfoWindow.close();delete this.defaultLocationInfoWindow}if(this.defaultLocationMarker){this.defaultLocationMarker.setVisible(false);g.maps.event.clearListeners(this.defaultLocationMarker,"click");g.maps.event.clearListeners(this.defaultLocationMarker,
"dragend");delete this.defaultLocationMarker}};d.gmaps.prototype.fitMarkers=function(){var a=new g.maps.LatLngBounds,b,c=[],e,f=0;if(this.markers)c=c.concat(this.markers);if(this.markersWaypoint)c=c.concat(this.markersWaypoint);if(this.directionsMarkers)c=c.concat(this.directionsMarkers);for(b=0;b<c.length;b++){e=c[b];if(e.obj)e=e.obj;if(e=e.getPosition()){++f;a.extend(e)}}f>1&&this.map.fitBounds(a)};d.gmaps.prototype.locate=function(a,b){var c="",e=b.infoWindow,f=b.marker,h=b.hiddenField,i=b.elem,
j=i?i.attr("data-woald-place"):null;j=j?this.JSONParse(j):null;var l=true,o=h?h.attr("name"):null,n=a.geometry.location,p,q,v,u=b.pos?b.pos.split(","):null;p=u?u[0]:n.lat();var w=u?u[1]:n.lng();u=this.showInfoWindow;this.map.setCenter(new g.maps.LatLng(p,w));if(j&&typeof j.showMarker==="boolean")l=j.showMarker;e&&e.close();f&&f.setVisible(false);if(a.geometry){if(i&&i.attr("type")!=="text")c=i[0].type==="select-one"?i.find(":selected").text():i.text();else if(i)c=i.val();p={address:c,lat:p,lng:w};
i&&i.attr("data-woald-postdata",this.encodedStringify(p));if(o==="waypoints")this.updateWaypointsField();else h&&h.val(this.JSONStringify(p));if(f){f.setPosition(n);l&&f.setVisible(true)}if(e){h=a.name?a.name:this.getLocality(a);if(j&&j.infoWindowDescription){q=j.infoWindowIcon;v=j.infoWindowDescription;h=c=null}if(c=this.getInfoWindowHtml(q,h,v,c)){e.setContent(c);u&&e.open(this.map,f)}}this.fitMarkers();m[this.costSummaryRequest]&&m[this.costSummaryRequest](this.getMapModel())}};d.gmaps.prototype.dragEnd=
function(a,b){var c=b.elem,e=[a.latLng.lat(),a.latLng.lng()].join(",");c&&c.val("");this.geocodeRequest(e,b)};d.gmaps.prototype.updateWaypointsField=function(){var a=this.$waypoints.find("input"),b=[],c,e;for(c=0;c<a.length;c++)(e=k(a[c]).attr("data-woald-postdata"))&&b.push(decodeURIComponent(e));b.length>0&&this.$waypointsField.val(this.JSONStringify(b))};d.gmaps.prototype.showDirection=function(a){var b=this,c=this.$fromLatLng.val(),e=this.$toLatLng.val();a=a||{showError:true};if(!c||!e)a.showError&&
this.enableDirection&&this.showError(this.directionEmptyError);else{this.closeError();if(this.enableDirection){a={origin:c,destination:e,travelMode:this.selectedTravelMode.toUpperCase(),avoidHighways:this.avoidHighways,avoidTolls:this.avoidTolls,unitSystem:this.unit};this.progressIndicator("show");a=this.getWaypoints(a);this.directionsService.route(a,function(f,h){if(h==g.maps.DirectionsStatus.OK){b.directionsDisplay.setDirections(f);b.resetMarkers();b.showDirectionStepsInline&&b.createDirectionsMarkers(f);
b.distanceMatrix();b.fitMarkers()}else b.showError(b.directionDataUnavailable);b.progressIndicator("hide");b.directionUpdated&&b.directionUpdated(f,h)});this.closeError()}else this.distanceMatrix()}};d.gmaps.prototype.resetDirection=function(){if(this.enableDirection&&this.directionsDisplay){this.resetMarkers();g.maps.event.clearListeners(this.directionsDisplay,"directions_changed");this.directionsDisplay.setMap(null);this.directionsDisplay.setPanel(null);this.directionsDisplay=new g.maps.DirectionsRenderer({draggable:this.draggableMarker,
suppressMarkers:this.showDirectionStepsInline});this.directionsDisplay.setMap(this.map);g.maps.event.addListener(this.directionsDisplay,"directions_changed",this.directionsChangedDelegate);this.$directionPanel.length>0&&this.directionsDisplay.setPanel(this.$directionPanel[0]);m[this.costSummaryRequest]&&m[this.costSummaryRequest]([])}};d.gmaps.prototype.createDirectionsMarkers=function(a){a=a.routes[0].legs;var b=a[0],c=a.length>1?a[a.length-1]:a[0];b.start_location&&this.directionsAddMarker(b.start_location,
b.start_address);c.end_location&&this.directionsAddMarker(c.end_location,c.end_address);for(b=0;b<a.length;b++)for(c=0;c<a[b].steps.length;c++)b===0&&c===0||b===a.length-1&&c===a[b].steps.length-1||this.directionsAddMarker(a[b].steps[c].start_point,a[b].steps[c].instructions,this.waypointMarkerIconUrl,this.waypointMarkerIconWidth,this.waypointMarkerIconHeight)};d.gmaps.prototype.directionsAddMarker=function(a,b,c,e,f){var h,i={};h=new g.maps.InfoWindow;h.setContent(b);if(!this.directionsInfoWindows)this.directionsInfoWindows=
[];this.directionsInfoWindows.push(h);a=new g.maps.Marker({position:a,map:this.map,anchorPoint:new g.maps.Point(0,-29),draggable:this.draggableMarker,animation:g.maps.Animation.DROP});if(e&&f)i.scaledSize=new g.maps.Size(e,f);if(c)i.url=c;k.isEmptyObject(i)||a.setIcon(i);if(!this.directionsMarkers)this.directionsMarkers=[];this.directionsMarkers.push(a);c=d.createCallback(this.toggleInfoWindowHandler,this,{infoWindow:h,marker:a});g.maps.event.addListener(a,"click",c)};d.gmaps.prototype.directionsChangedHandler=
function(){var a=this.directionsDisplay.getDirections(),b=a.routes[0].legs[0].start_address,c=a.routes[0].legs[0].start_location;c={address:b,lat:c.lat(),lng:c.lng()};var e,f,h=this.$waypoints.find("input"),i,j,l=a.routes[0].legs,o,n;o=l.length;a=l[o-1].end_address;e=l[o-1].end_location;e={address:a,lat:e.lat(),lng:e.lng()};for(n=1;n<o;n++){f=l[n];if(h.length>0){i=f.start_address;f=f.start_location;j={address:i,lat:f.lat(),lng:f.lng()};f=k(h[n-1]);f.attr("data-woald-postdata",this.encodedStringify(j));
f.val(i)}}if(this.$fromLatLng.attr("type")==="text"){this.$fromLatLng.val(b);this.$fromLatLng.attr("data-woald-postdata",this.encodedStringify(c));this.$departureField.val(this.JSONStringify(c))}if(this.$toLatLng.attr("type")==="text"){this.$toLatLng.val(a);this.$toLatLng.attr("data-woald-postdata",this.encodedStringify(e));this.$destinationField.val(this.JSONStringify(e))}this.updateWaypointsField();this.distanceMatrix();!this.enableDistance&&m[this.costSummaryRequest]&&m[this.costSummaryRequest](this.getMapModel())};
d.gmaps.prototype.getWaypoints=function(a){var b=this.$waypoints.find("input"),c=[],e=this;k.each(b,function(f,h){var i=k.trim(k(h).val());i&&c.push({location:i,stopover:e.stopover})});if(c.length>0){a.waypoints=c;if(this.stopover&&this.optimizeWaypoints)a.optimizeWaypoints=this.optimizeWaypoints}return a};d.gmaps.prototype.distanceMatrix=function(){var a=this.$fromLatLng.val(),b=this.$toLatLng.val(),c,e;if(a||b)if(this.enableDistance){this.progressIndicator("show");if(!this.distanceMatrixService)this.distanceMatrixService=
new g.maps.DistanceMatrixService;if(!this.distanceMatrixDelegate)this.distanceMatrixDelegate=d.createDelegate(this,this.distanceMatrixHandler);a={origins:[a],destinations:[b],travelMode:this.selectedTravelMode.toUpperCase(),unitSystem:this.unit,durationInTraffic:false,avoidHighways:this.avoidHighways,avoidTolls:this.avoidTolls};c=this.getWaypoints({});if(c.waypoints){a.destinations=[];for(e in c.waypoints)a.destinations.push(c.waypoints[e].location);a.destinations.push(b)}this.distanceMatrixService.getDistanceMatrix(a,
this.distanceMatrixDelegate)}};d.gmaps.prototype.distanceMatrixHandler=function(a,b){var c,e,f,h,i,j=0,l=0,o,n,p,q;this.progressIndicator("hide");if(b===g.maps.DistanceMatrixStatus.OK){c=a.originAddresses;e=a.destinationAddresses;if(this.$distancePlaceHolder.length>0){this.$distancePlaceHolder.empty();this.$distancePlaceHolder.removeClass("hide")}for(p=0;p<c.length;p++){f=a.rows[p].elements;for(q=0;q<f.length;q++){h=f[q];j+=h.distance.value;l+=h.duration.value;if(this.$distancePlaceHolder.length>
0){o=c[p];n=e[q];i=s.formatNumber(h.distance.value/this.conversion,this.decimalPrecision,this.thousandsSep,this.decimalPoint);h=this.getDistanceHtml(i+" "+this.unitLabelText,h.duration.text,o,n);this.$distancePlaceHolder.append(h)}}}c=s.formatNumber(j/this.conversion,this.decimalPrecision,this.thousandsSep,this.decimalPoint);this.$distanceField.val(c);this.$durationField.val(l);m[this.costSummaryRequest]&&m[this.costSummaryRequest](this.getMapModel());this.distanceUpdated&&this.distanceUpdated(j,
c)}};d.gmaps.prototype.getFriendlyDuration=function(a){var b=parseInt(a,10);a=Math.floor(b/3600);b=Math.floor((b-a*3600)/60);if(b<10)b="0"+b;return a+":"+b};d.gmaps.prototype.getDistanceHtml=function(a,b,c,e){return'<div class="calendarista-typography--body2"><div>'+this.distanceLabelText+' <span class="woald-item-total-distance">'+a+"</span></div><div>"+c+" - "+e+" / <strong>"+this.durationLabelText+"</strong>: "+b+"</div></div>"};d.gmaps.prototype.getWaypointsHtml=function(a,b){b=b===d.gmaps.collapseDirection.inside?
"in":"out";return'<div class="form-group calendarista-row-single collapse '+b+' woald-gmaps-field-shade woald-waypoint-group"><div class="input-group"><span class="input-group-text woald-waypoint-badge">'+a+'</span><input type="text" class="form-control calendarista-typography--caption1" placeholder="Add a stop on the way" name="waypoint[]" data-woald-waypoint-id="'+a+'" /><button type="button" class="btn btn-outline-secondary calendarista-typography--button" name="waypointremove"  title="Remove this stop" data-woald-id="'+
a+'"><i class="fa fa-minus"></i></button></div></div>'};d.gmaps.prototype.getWaypointContextMenu=function(a){return'<a href="#" class="list-group-item list-group-item-action calendarista-typography--caption1" data-woald-menu="2" data-woald-waypoint-id="'+a+'"><span class="badge badge-dark woald-waypoint-badge">'+a+"</span> "+this.waypointContextMenuLabel+"</a>"};d.gmaps.prototype.getContextMenu=function(){var a=[];this.enableDepartureField&&this.$fromLatLng.attr("type")==="text"&&a.push('<a href="#" class="list-group-item list-group-item-action calendarista-typography--caption1" data-woald-menu="0"><i class="fas fa-map-marker"></i>&nbsp;'+
this.departureContextMenuLabel+"</a>");this.enableDestinationField&&this.$toLatLng.attr("type")==="text"&&a.push('<a href="#" class="list-group-item list-group-item-action calendarista-typography--caption1" data-woald-menu="1"><i class="fas fa-map-marker"></i>&nbsp;'+this.destinationContextMenuLabel+"</a>");if(a.length)return'<div class="list-group woald-gmaps-contextmenu hide">'+a.join("")+"</div>";this.$contextMenuHint.length&&this.$contextMenuHint.addClass("hide");return null};d.gmaps.prototype.getInfoWindowHtml=
function(a,b,c,e){var f="";if(a)f='<div class="col-xl-3 woald-thumbnail-col"><img src="'+a+'" alt="" class="img-thumbnail"></div><div class="col-xl-9 woald-info-col">';if(c||e)f+='<div class="woald-infowindow">';if(c)f+='<div class="woald-description">'+c+"</div>";if(e){f+='<div class="woald-address">';f+='<strong class="woald-title">'+b+"</strong><br>";f+=e;f+="</div>"}if(c||e)f+="</div>";if(a)f+="</div>";return f};d.gmaps.prototype.directionPanelCloseHandler=function(){this.$direction.button("toggle");
this.$directionPanel.calendaristaCollapse("hide")};d.gmaps.prototype.resize=function(){if(this.map&&this.map.getCenter){var a=this.map.getCenter();g.maps.event.trigger(this.map,"resize");this.map.setCenter(a)}};d.gmaps.prototype.closeAllInfoWindows=function(){var a,b,c;for(a in this.infoWindows){b=this.infoWindows[a];c=this.markers[a];b&&this.isOpen(b)&&b.close(this.map,c)}this.defaultLocationMarker&&this.defaultLocationInfoWindow&&this.isOpen(this.defaultLocationInfoWindow)&&this.defaultLocationInfoWindow.close(this.map,
this.defaultLocationMarker)};d.gmaps.prototype.isOpen=function(a){a=a.getMap();return a!==null&&typeof a!=="undefined"};d.gmaps.prototype.toggleInfoWindowHandler=function(a,b){this.toggleInfoWindow(b)};d.gmaps.prototype.toggleInfoWindow=function(a){var b=a.infoWindow;a=a.marker;if(b)this.isOpen(b)?b.close(this.map,a):b.open(this.map,a)};d.gmaps.prototype.geoLocate=function(a){if(navigator.geolocation){this.browserSupportFlag=true;this.getCurrentPositionDelegate=d.createCallback(this.getCurrentPosition,
this,a);this.handleNoGeoLocationDelegate=d.createDelegate(this,this.handleNoGeoLocation);navigator.geolocation.getCurrentPosition(this.getCurrentPositionDelegate,this.handleNoGeoLocationDelegate,null)}else{this.browserSupportFlag=false;this.handleNoGeolocation()}this.closeError()};d.gmaps.prototype.geocodeRequest=function(a,b){var c=a.split(","),e={address:a};if(c){c=new g.maps.LatLng(c[0],c[1]);e={latLng:c}}b.pos=a;this.geocode(e,b)};d.gmaps.prototype.getCurrentPosition=function(a,b){this.geocode({latLng:new g.maps.LatLng(a.coords.latitude,
a.coords.longitude)},b)};d.gmaps.prototype.geocode=function(a,b){var c;if(!this.geocoder)this.geocoder=new g.maps.Geocoder;b.preloading||this.progressIndicator("show");c=d.createCallback(this.reverseGeocodeHandler,this,b);this.geocoder.geocode(a,c)};d.gmaps.prototype.reverseGeocodeHandler=function(a,b,c){var e=c.elem,f=c.hiddenField;c.preloading||this.progressIndicator("hide");if(b===g.maps.GeocoderStatus.OK){e&&e.val()===""&&e.val(a[0].formatted_address);this.locate(a[0],c)}else b==g.maps.GeocoderStatus.OVER_QUERY_LIMIT&&
function(h,i){m.setTimeout(function(){i.geocodeRequest(h.pos,h)},i.queryLimitTimeout)}(c,this);f&&["departure","destination"].indexOf(f.attr("name"))!==-1&&!this.enableDirection&&m[this.costSummaryRequest]&&m[this.costSummaryRequest](this.getMapModel());this.loadNextLocation()};d.gmaps.prototype.loadNextLocation=function(){this.initSearch()||this.showDirection({showError:false})};d.gmaps.prototype.handleNoGeoLocation=function(a){var b=new g.maps.LatLng(this.defaultLocation.lat,this.defaultLocation.lng);
if(this.browserSupportFlag===true){this.showError(this.posErrorMsg);m.console.log(a.message||"Geolocation service failed.")}else{this.showError(this.geolocationErrorMsg);m.console.log(a.message||"Your browser doesn't support geolocation.")}this.map.setCenter(b)};d.gmaps.prototype.showError=function(a){if(a){this.$errorContainer.html(a);this.$errorPanelContainer.removeClass("hide");this.$errorPanel.calendaristaCollapse("show")}};d.gmaps.prototype.closeError=function(){this.$errorPanel.calendaristaCollapse("hide")};
d.gmaps.prototype.errorPanelCloseHandler=function(){this.closeError()};d.gmaps.prototype.unloadHandler=function(){this.unload()};d.gmaps.prototype.encodedStringify=function(a){return encodeURIComponent(this.JSONStringify(a))};d.gmaps.prototype.JSONParse=function(a){return m.JSON.parse(decodeURIComponent(a))};d.gmaps.prototype.JSONStringify=function(a){return m.JSON.stringify(a)};d.gmaps.prototype.getMapModel=function(){var a=k('input[name="waypoints"]'),b=[{name:"fromPlaceId",value:this.$fromPlaceId.val()},
{name:"toPlaceId",value:this.$toPlaceId.val()},{name:"distance",value:this.$distanceField.val()},{name:"duration",value:this.$durationField.val()},{name:"departure",value:this.$departureField.val()},{name:"destination",value:this.$destinationField.val()},{name:"fromLatLng",value:this.$fromLatLng.val()},{name:"toLatLng",value:this.$toLatLng.val()},{name:"unitType",value:this.$unitField.val()=="km"?0:1},{name:"unit",value:this.$unitField.val()}];a.length>0&&a.val()&&b.push({name:"waypoints",value:a.val()});
return b};d.gmaps.prototype.decodeSpecialCharacters=function(a){if(!a)return"";return k("<div/>").html(a).text()};d.gmaps.prototype.unload=function(){var a;if(this.autocompletes){for(a in this.autocompletes)g.maps.event.clearListeners(this.autocompletes[a],"place_changed");this.autocompletes.length=0}if(this.markers){for(a in this.markers){g.maps.event.clearListeners(this.markers[a],"click");g.maps.event.clearListeners(this.markers[a],"dragend")}this.markers.length=0}if(this.autocompletesWaypoint){for(a in this.autocompletesWaypoint)g.maps.event.clearListeners(this.autocompletesWaypoint[a].obj,
"place_changed");this.autocompletesWaypoint.length=0}if(this.markersWaypoint){for(a in this.markersWaypoint){g.maps.event.clearListeners(this.markersWaypoint[a].obj,"click");g.maps.event.clearListeners(this.markersWaypoint[a].obj,"dragend")}this.markersWaypoint.length=0}this.$travelModeList.off();if(this.enableContextMenu){g.maps.event.clearListeners(this.map,"rightclick");g.maps.event.clearListeners(this.map,"click");k(m.document).off("click",this.contextMenuExitDelegate)}this.tilesLoadedDelegate&&
g.maps.event.clearListeners(this.map,"tilesloaded");this.highwayClickDelegate&&this.$highway.off("change",this.highwayClickDelegate);this.tollClickDelegate&&this.$toll.off("change",this.tollClickDelegate);this.trafficClickDelegate&&this.$traffic.off("change",this.trafficClickDelegate);this.reverseClickDelegate&&this.$reverse.off("change",this.reverseClickDelegate);this.directionClickDelegate&&this.$direction.off("change",this.directionClickDelegate);this.milesClickDelegate&&this.$miles.off("change",
this.milesClickDelegate);this.kmClickDelegate&&this.$km.off("change",this.kmClickDelegate);this.myPosClickDelegate&&this.$myPosButton.off("change",this.myPosClickDelegate);this.directionPanelCloseDelegate&&this.$directionPanelCloseButton.off("change",this.directionPanelCloseDelegate);this.errorPanelCloseDelegate&&this.$errorPanelCloseButton.off("change",this.errorPanelCloseDelegate);this.zoomInDelegate&&this.$zoomInButton.off("change",this.zoomInDelegate);this.directionsDisplay&&g.maps.event.clearListeners(this.directionsDisplay,
"directions_changed");this.waypointsAddDelegate&&this.$waypointsAddButton.off("click",this.waypointsAddDelegate);if(this.autocompleteOnPasteDelegate){this.$fromLatLng.off("paste",this.autocompleteOnPasteDelegate);this.$toLatLng.off("paste",this.autocompleteOnPasteDelegate)}if(this.directionPanelToggleDelegate){this.$directionPanel.off("shown.bs.collapse",this.directionPanelToggleDelegate);this.$directionPanel.off("hidden.bs.collapse",this.directionPanelToggleDelegate)}this.trafficLayerMapChangedDelegate&&
g.maps.event.clearListeners(this.trafficLayer,"map_changed");this.fromLatLngChangeDelegate&&this.$fromLatLng.off("change",this.fromLatLngChangeDelegate);this.toLatLngChangeDelegate&&this.$toLatLng.on("change",this.toLatLngChangeDelegate);if(this.$waypoionts&&this.$waypoints.length>0){this.$waypoints.find("input").off();this.$waypoints.find('button[name="waypointremove"]').off();this.$waypoints.find(".form-group").off()}this.$contextMenu&&this.$contextMenu.length>0&&this.$contextMenu.find("a").off();
for(a=0;a<this.placeChangedListeners;a++)g.maps.event.clearListeners(this.placeChangedListeners[a],"place_changed");this.clearDefaultLocation();this.initDelegate&&this.$window.off("load",this.initDelegate);this.resizeDelegate&&this.$window.off("resize",this.resizeDelegate);this.unloadDelegate&&this.$window.off("unload",this.unloadDelegate);this.distanceMatrixService&&delete this.distanceMatrixService;this.distanceMatrixDelegate&&delete this.distanceMatrixDelegate}})(window,document,google,Woald,window.jQuery,
window.accounting,window.calendarista_wp_ajax);
(function(m,r){r.gmaps.prototype.getTemplate=function(){return'<div class="woald-container"><div class="woald-controls form-horizontal"><div class="woald-content collapse in"><div class="col-lg-12 woald-photo-background"><div class="woald-content-inner"><div class="form-group woald-options1-container"><div class="col-lg-12"><div class="btn-group woald-button-right-margin" data-toggle="buttons"><label class="btn btn-default woald-minimize-button" title="Minimize View"><input type="checkbox" name="minimize" data-parsley-excluded="true" checked><i class="fa fa-chevron-up"></i></label><label class="btn btn-primary woald-direction" title="Show direction"><input type="checkbox" name="direction" data-parsley-excluded="true"><i class="fa fa-road"></i></label><label class="btn btn-primary woald-reverse" title="Reverse direction"><input type="checkbox" name="reverse" data-parsley-excluded="true"><i class="fa fa-sort"></i></label></div><div class="btn-group woald-button-right-margin woald-measurement-container" data-toggle="buttons"><label class="btn btn-default woald-miles"><input type="radio" name="measurement" value="miles" data-parsley-excluded="true" checked>Miles</label><label class="btn btn-default woald-km"><input type="radio" name="measurement" data-parsley-excluded="true" value="km">KM</label></div><div class="btn-group woald-travelmode"><button type="button" class="btn btn-default woald-travelmode-heading" data-parsley-excluded="true"></button><button type="button" class="btn btn-default" data-toggle="dropdown" aria-expanded="false" data-parsley-excluded="true"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button><ul class="dropdown-menu" role="menu"><li><a href="#" data-woald-drivingmode="driving"></a></li><li><a href="#" data-woald-drivingmode="walking"></a></li><li><a href="#" data-woald-drivingmode="bicycling"></a></li><li><a href="#" data-woald-drivingmode="transit"></a></li></ul></div></div></div><div class="form-group form-inline woald-options2-container"><div class="col-lg-12"><div class="checkbox"><label class="woald-inline-checkbox"><input type="checkbox" name="highway" data-parsley-excluded="true" checked>Avoid Highways</label></div><div class="checkbox"><label class="woald-inline-checkbox"><input type="checkbox" name="toll" data-parsley-excluded="true"> Avoid Tolls</label></div><div class="checkbox"><label class="woald-inline-checkbox"><input type="checkbox" name="traffic" data-parsley-excluded="true">Show Traffic</label></div></div></div><div class="form-group woald-progressbar collapse out"><div class="col-lg-12"><div class="progress progress-striped"><div class="progress-bar"></div></div></div></div><div class="woald-content-before hide"></div><div class="form-group woald-gmaps-field-shade woald-departure-field-container"><div class="col-lg-12"><div class="input-group"><input type="text" class="woald_parsley_validated form-control" placeholder="Departure" data-parsley-trigger="change" data-parsley-errors-container=".fromlatlng-error-container" name="fromLatLng" /><span class="input-group-btn woald-departure-group"><button type="button" class="btn btn-default" name="search"><i class="fa fa-search"></i></button><button type="button" class="btn btn-primary" title="Find my position" name="mypos"><i class="fa fa-record"></i></button></span></div><div class="fromlatlng-error-container"></div></div></div><div class="woald-waypoints-placeholder"></div><div class="form-group woald-gmaps-field-shade woald-destination-field-container"><div class="col-lg-12"><div class="input-group"><input type="text" class="woald_parsley_validated form-control" placeholder="Destination" data-parsley-trigger="change" data-parsley-errors-container=".tolatlng-error-container" name="toLatLng"><span class="input-group-btn woald-destination-group"><button type="button" class="btn btn-default" name="search"> <i class="fa fa-search"></i></button></span></div><div class="tolatlng-error-container"></div></div></div><div class="form-group woald-waypoint-add-button-container"><div class="col-lg-12"><div class="pull-right"><button type="button" class="btn btn-primary woald-button-right-margin" name="add" title="Add way point"><i class="fa fa-plus"></i></button><div class="clearfix"></div></div></div></div><div class="woald-content-after hide"></div><div class="form-group woald-distance-placeholder hide"></div><div class="form-group woald-distance-and-cost hide"><div class="col-lg-12"><h3 class="form-control-static"><span class="woald-totals"><span class="woald-total-distance"></span> <span class="woald-total-cost" title="Total cost"><span></span></h3></div><div class="clearfix"></div></div><div class="form-group woald-submit-button"><div class="col-lg-12"><button type="submit" name="submitButton" class="btn btn-primary pull-right">Submit</button><div class="clearfix"></div></div></div><div class="woald-content-end hide"></div><div class="form-group woald-error-panel-container hide"><div class="col-lg-12"><div class="woald-error-panel collapse out"><div class="alert alert-danger" role="alert"><button type="button" class="close"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><span class="woald-error-container"></span></div></div></div></div><div class="form-group woald-direction-panel-container hide"><div class="col-lg-12"><div class="woald-direction-panel collapse out"></div></div></div></div></div><div class="clearfix"></div></div><div class="clearfix"></div><div class="btn-group-vertical woald-knobs"><button type="button" class="btn btn-default woald-minimize-button" title="Minimize View"><i class="fa fa-chevron-up"></i></button><button type="button" class="btn btn-default woald-zoom-in-button" title="Zoom in"><i class="fa fa-plus"></i></button><button type="button" class="btn btn-default woald-zoom-out-button" title="Zoom out"><i class="fa fa-minus"></i></button></div><div class="clearfix"></div></div><div class="woald-map"><div class="woald-map-canvas"/></div></div>'}})(window,Woald);
